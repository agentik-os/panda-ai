<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 1200">
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-size="24" font-weight="bold" fill="#333">
    Agentik OS - 9-Stage Message Pipeline
  </text>

  <!-- User Input -->
  <rect x="250" y="60" width="300" height="50" fill="#4F46E5" rx="5"/>
  <text x="400" y="90" text-anchor="middle" font-size="16" fill="white" font-weight="bold">
    User Message (Any Channel)
  </text>

  <!-- Arrow -->
  <path d="M 400 110 L 400 140" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 1: Normalize -->
  <rect x="200" y="140" width="400" height="80" fill="#10B981" stroke="#059669" stroke-width="2" rx="5"/>
  <text x="400" y="165" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 1: NORMALIZE
  </text>
  <text x="400" y="185" text-anchor="middle" font-size="12" fill="white">
    Convert channel format → unified Message
  </text>
  <text x="400" y="205" text-anchor="middle" font-size="11" fill="#D1FAE5">
    File: pipeline/normalize.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 220 L 400 250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 2: Route -->
  <rect x="200" y="250" width="400" height="80" fill="#3B82F6" stroke="#2563EB" stroke-width="2" rx="5"/>
  <text x="400" y="275" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 2: ROUTE
  </text>
  <text x="400" y="295" text-anchor="middle" font-size="12" fill="white">
    Determine target agent (@mentions/channel/default)
  </text>
  <text x="400" y="315" text-anchor="middle" font-size="11" fill="#DBEAFE">
    File: pipeline/route.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 330 L 400 360" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 3: Load Memory -->
  <rect x="200" y="360" width="400" height="80" fill="#8B5CF6" stroke="#7C3AED" stroke-width="2" rx="5"/>
  <text x="400" y="385" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 3: LOAD MEMORY
  </text>
  <text x="400" y="405" text-anchor="middle" font-size="12" fill="white">
    Fetch conversation context (short-term + session)
  </text>
  <text x="400" y="425" text-anchor="middle" font-size="11" fill="#EDE9FE">
    File: pipeline/load-memory.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 440 L 400 470" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 4: Model Select -->
  <rect x="200" y="470" width="400" height="80" fill="#F59E0B" stroke="#D97706" stroke-width="2" rx="5"/>
  <text x="400" y="495" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 4: MODEL SELECT
  </text>
  <text x="400" y="515" text-anchor="middle" font-size="12" fill="white">
    Choose optimal model (complexity + budget)
  </text>
  <text x="400" y="535" text-anchor="middle" font-size="11" fill="#FEF3C7">
    File: pipeline/model-select.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 550 L 400 580" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 5: Tool Resolution -->
  <rect x="200" y="580" width="400" height="80" fill="#EC4899" stroke="#DB2777" stroke-width="2" rx="5"/>
  <text x="400" y="605" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 5: TOOL RESOLUTION
  </text>
  <text x="400" y="625" text-anchor="middle" font-size="12" fill="white">
    Resolve available MCP tools for agent
  </text>
  <text x="400" y="645" text-anchor="middle" font-size="11" fill="#FCE7F3">
    File: pipeline/tool-resolution.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 660 L 400 690" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 6: Execute -->
  <rect x="200" y="690" width="400" height="80" fill="#EF4444" stroke="#DC2626" stroke-width="2" rx="5"/>
  <text x="400" y="715" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 6: EXECUTE
  </text>
  <text x="400" y="735" text-anchor="middle" font-size="12" fill="white">
    Send to AI model (Claude/GPT) → Get response
  </text>
  <text x="400" y="755" text-anchor="middle" font-size="11" fill="#FEE2E2">
    File: pipeline/execute.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 770 L 400 800" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 7: Save Memory -->
  <rect x="200" y="800" width="400" height="80" fill="#06B6D4" stroke="#0891B2" stroke-width="2" rx="5"/>
  <text x="400" y="825" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 7: SAVE MEMORY
  </text>
  <text x="400" y="845" text-anchor="middle" font-size="12" fill="white">
    Store conversation turn in memory tiers
  </text>
  <text x="400" y="865" text-anchor="middle" font-size="11" fill="#CFFAFE">
    File: pipeline/save-memory.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 880 L 400 910" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 8: Track Cost -->
  <rect x="200" y="910" width="400" height="80" fill="#14B8A6" stroke="#0D9488" stroke-width="2" rx="5"/>
  <text x="400" y="935" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 8: TRACK COST
  </text>
  <text x="400" y="955" text-anchor="middle" font-size="12" fill="white">
    Log token usage and calculate cost
  </text>
  <text x="400" y="975" text-anchor="middle" font-size="11" fill="#CCFBF1">
    File: pipeline/track-cost.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 990 L 400 1020" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Stage 9: Send Response -->
  <rect x="200" y="1020" width="400" height="80" fill="#84CC16" stroke="#65A30D" stroke-width="2" rx="5"/>
  <text x="400" y="1045" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
    Stage 9: SEND RESPONSE
  </text>
  <text x="400" y="1065" text-anchor="middle" font-size="12" fill="white">
    Send response back to user's channel
  </text>
  <text x="400" y="1085" text-anchor="middle" font-size="11" fill="#ECFCCB">
    File: pipeline/send-response.ts
  </text>

  <!-- Arrow -->
  <path d="M 400 1100 L 400 1130" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- User Output -->
  <rect x="250" y="1130" width="300" height="50" fill="#4F46E5" rx="5"/>
  <text x="400" y="1160" text-anchor="middle" font-size="16" fill="white" font-weight="bold">
    AI Response to User
  </text>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>
</svg>
